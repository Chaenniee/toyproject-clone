{"ast":null,"code":"var _jsxFileName = \"/Users/chaenniee/Documents/team10-web/toyproject/src/components/module/ModuleBlock.tsx\",\n  _s = $RefreshSig$();\nimport styles from './ModuleBlock.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCaretDown, faCaretRight, faPaperclip } from '@fortawesome/free-solid-svg-icons';\nimport { useEffect, useState } from 'react';\nimport { apiGetFile, apiGetModules } from '../../lib/api';\nimport { useSessionContext } from '../../context/SessionContext';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const DownloadFile = _ref => {\n  let {\n    file,\n    token\n  } = _ref;\n  const originalFileURL = decodeURI(file);\n  const urlParams = originalFileURL.split('modules/')[1].split('?X-Amz')[0];\n  const parts = urlParams.split('.');\n  const extension = parts[parts.length - 1];\n  const handleDownload = async event => {\n    event.preventDefault();\n    await apiGetFile(file, token, urlParams, extension);\n  };\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: styles.download,\n    onClick: handleDownload,\n    children: urlParams\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 33,\n    columnNumber: 5\n  }, this);\n};\n_c = DownloadFile;\nconst Module = _ref2 => {\n  let {\n    module,\n    openedToggles,\n    handleSingleToggle,\n    idx,\n    token\n  } = _ref2;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.moduleContainer,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      onClick: () => handleSingleToggle(idx),\n      children: [/*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: openedToggles[idx] ? faCaretDown : faCaretRight,\n        className: styles.caret\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 9\n      }, this), module.name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"article\", {\n      className: openedToggles[idx] ? styles.contentContainerShow : styles.contentContainer,\n      children: module.module_content.map((content, contentIdx) => /*#__PURE__*/_jsxDEV(\"section\", {\n        className: openedToggles[idx] ? styles.contentShow : styles.content,\n        children: [/*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n          icon: faPaperclip,\n          className: styles.paperClip\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(DownloadFile, {\n          file: content.url,\n          token: token\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 13\n        }, this)]\n      }, contentIdx, true, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 5\n  }, this);\n};\n_c2 = Module;\nexport default function ModuleBlock() {\n  _s();\n  const {\n    token,\n    getRefreshToken\n  } = useSessionContext();\n  const {\n    subjectid\n  } = useParams();\n  const [modules, setModules] = useState([]);\n  // module의 개수와 같은 개수의 1로 이루어진 배열 생성 (처음에는 모든 모듈이 열려 있는 상태)\n  // 모듈(토글)이 열려 있으면 1, 아니면 0\n  const [openedToggles, setOpenedToggles] = useState([]);\n  // Array(modules.length).fill(true)\n\n  const navigate = useNavigate();\n  // 각 모듈 헤더 클릭 시 접고 펼치기\n  const handleSingleToggle = id => {\n    const newOpenedToggles = [...openedToggles.slice(0, id), !openedToggles[id], ...openedToggles.slice(id + 1)];\n    setOpenedToggles(newOpenedToggles);\n  };\n\n  // 하나라도 펼쳐진 모듈이 있으면 모든 모듈 접기, 모두 접혀있으면 모든 모듈 펼치기\n  const handleAllToggle = () => {\n    if (openedToggles.includes(true)) {\n      const newOpenedToggles = Array(modules.length).fill(false);\n      setOpenedToggles(newOpenedToggles);\n    } else {\n      const newOpenedToggles = Array(modules.length).fill(true);\n      setOpenedToggles(newOpenedToggles);\n    }\n  };\n  const getModules = async (token, class_id) => {\n    const res = await apiGetModules(token, class_id);\n    return res;\n  };\n  useEffect(() => {\n    (async () => {\n      try {\n        const id = Number(subjectid);\n        const res = await getModules(token, id);\n        setModules(res.data[0].weekly);\n        setOpenedToggles(Array(res.data[0].weekly.length).fill(true));\n      } catch {\n        const id = Number(subjectid);\n        const localRefreshToken = localStorage.getItem('refresh');\n        const resToken = await getRefreshToken(localRefreshToken ? localRefreshToken : 'temp');\n        const newToken = resToken.data.access;\n        const res = await getModules(newToken, id);\n        setModules(res.data[0].weekly);\n        setOpenedToggles(Array(res.data[0].weekly.length).fill(true));\n      }\n    })();\n  }, [subjectid, token]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.wrapper,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.headerbar,\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleAllToggle,\n        children: openedToggles.includes(true) ? '모든 모듈 접기' : '모든 모듈 펼치기'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"article\", {\n      children: modules && modules.map((module, idx) => /*#__PURE__*/_jsxDEV(Module, {\n        module: module,\n        idx: idx,\n        openedToggles: openedToggles,\n        handleSingleToggle: handleSingleToggle,\n        token: token\n      }, module.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 5\n  }, this);\n}\n_s(ModuleBlock, \"IjXApSDfQ0TkaMA1QCuAaCBgRaE=\", false, function () {\n  return [useSessionContext, useParams, useNavigate];\n});\n_c3 = ModuleBlock;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"DownloadFile\");\n$RefreshReg$(_c2, \"Module\");\n$RefreshReg$(_c3, \"ModuleBlock\");","map":{"version":3,"names":["styles","FontAwesomeIcon","faCaretDown","faCaretRight","faPaperclip","useEffect","useState","apiGetFile","apiGetModules","useSessionContext","useNavigate","useParams","DownloadFile","file","token","originalFileURL","decodeURI","urlParams","split","parts","extension","length","handleDownload","event","preventDefault","download","Module","module","openedToggles","handleSingleToggle","idx","moduleContainer","caret","name","contentContainerShow","contentContainer","module_content","map","content","contentIdx","contentShow","paperClip","url","ModuleBlock","getRefreshToken","subjectid","modules","setModules","setOpenedToggles","navigate","id","newOpenedToggles","slice","handleAllToggle","includes","Array","fill","getModules","class_id","res","Number","data","weekly","localRefreshToken","localStorage","getItem","resToken","newToken","access","wrapper","headerbar"],"sources":["/Users/chaenniee/Documents/team10-web/toyproject/src/components/module/ModuleBlock.tsx"],"sourcesContent":["import styles from './ModuleBlock.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faCaretDown,\n  faCaretRight,\n  faPaperclip,\n} from '@fortawesome/free-solid-svg-icons';\nimport { useEffect, useState } from 'react';\nimport { apiGetFile, apiGetModules } from '../../lib/api';\nimport { useSessionContext } from '../../context/SessionContext';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { ModuleInterface } from '../../lib/types';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\n\nexport const DownloadFile = ({\n  file,\n  token,\n}: {\n  file: string;\n  token: string | null;\n}) => {\n  const originalFileURL = decodeURI(file);\n  const urlParams = originalFileURL.split('modules/')[1].split('?X-Amz')[0];\n  const parts = urlParams.split('.');\n  const extension = parts[parts.length - 1];\n  const handleDownload = async (event: React.MouseEvent<HTMLSpanElement>) => {\n    event.preventDefault();\n    await apiGetFile(file, token, urlParams, extension);\n  };\n\n  return (\n    <span className={styles.download} onClick={handleDownload}>\n      {urlParams}\n    </span>\n  );\n};\n\nconst Module = ({\n  module,\n  openedToggles,\n  handleSingleToggle,\n  idx,\n  token,\n}: {\n  module: ModuleInterface;\n  openedToggles: boolean[];\n  handleSingleToggle: (id: number) => void;\n  idx: number;\n  token: string | null;\n}) => {\n  return (\n    <div className={styles.moduleContainer}>\n      <header onClick={() => handleSingleToggle(idx)}>\n        <FontAwesomeIcon\n          icon={openedToggles[idx] ? faCaretDown : faCaretRight}\n          className={styles.caret}\n        />\n        {module.name}\n      </header>\n\n      <article\n        className={\n          openedToggles[idx]\n            ? styles.contentContainerShow\n            : styles.contentContainer\n        }\n      >\n        {module.module_content.map((content, contentIdx) => (\n          <section\n            key={contentIdx}\n            className={openedToggles[idx] ? styles.contentShow : styles.content}\n          >\n            <FontAwesomeIcon icon={faPaperclip} className={styles.paperClip} />\n            <DownloadFile file={content.url} token={token} />\n            {/* <a href={content.url} download>\n              download\n            </a> */}\n          </section>\n        ))}\n      </article>\n      {/* )} */}\n    </div>\n  );\n};\n\nexport default function ModuleBlock() {\n  const { token, getRefreshToken } = useSessionContext();\n  const { subjectid } = useParams();\n  const [modules, setModules] = useState<ModuleInterface[]>([]);\n  // module의 개수와 같은 개수의 1로 이루어진 배열 생성 (처음에는 모든 모듈이 열려 있는 상태)\n  // 모듈(토글)이 열려 있으면 1, 아니면 0\n  const [openedToggles, setOpenedToggles] = useState<boolean[]>([]);\n  // Array(modules.length).fill(true)\n\n  const navigate = useNavigate();\n  // 각 모듈 헤더 클릭 시 접고 펼치기\n  const handleSingleToggle = (id: number) => {\n    const newOpenedToggles = [\n      ...openedToggles.slice(0, id),\n      !openedToggles[id],\n      ...openedToggles.slice(id + 1),\n    ];\n    setOpenedToggles(newOpenedToggles);\n  };\n\n  // 하나라도 펼쳐진 모듈이 있으면 모든 모듈 접기, 모두 접혀있으면 모든 모듈 펼치기\n  const handleAllToggle = () => {\n    if (openedToggles.includes(true)) {\n      const newOpenedToggles = Array(modules.length).fill(false);\n      setOpenedToggles(newOpenedToggles);\n    } else {\n      const newOpenedToggles = Array(modules.length).fill(true);\n      setOpenedToggles(newOpenedToggles);\n    }\n  };\n\n  const getModules = async (token: string | null, class_id: number) => {\n    const res = await apiGetModules(token, class_id);\n    return res;\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const id = Number(subjectid);\n        const res = await getModules(token, id);\n        setModules(res.data[0].weekly);\n        setOpenedToggles(Array(res.data[0].weekly.length).fill(true));\n      } catch {\n        const id = Number(subjectid);\n        const localRefreshToken = localStorage.getItem('refresh');\n        const resToken = await getRefreshToken(\n          localRefreshToken ? localRefreshToken : 'temp'\n        );\n        const newToken = resToken.data.access;\n        const res = await getModules(newToken, id);\n        setModules(res.data[0].weekly);\n        setOpenedToggles(Array(res.data[0].weekly.length).fill(true));\n      }\n    })();\n  }, [subjectid, token]);\n\n  return (\n    <div className={styles.wrapper}>\n      <div className={styles.headerbar}>\n        <button onClick={handleAllToggle}>\n          {openedToggles.includes(true) ? '모든 모듈 접기' : '모든 모듈 펼치기'}\n        </button>\n      </div>\n      <article>\n        {modules &&\n          modules.map((module, idx) => (\n            <Module\n              key={module.id}\n              module={module}\n              idx={idx}\n              openedToggles={openedToggles}\n              handleSingleToggle={handleSingleToggle}\n              token={token}\n            />\n          ))}\n      </article>\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}